# Add histology grouping
thr_his <- thr_his %>%
  mutate(histology = case_when(
    # Main histology groups
    between(as.numeric(histologicTypeIcdO3), 8140, 8384) ~ 'Adenocarcinoma',  
    between(as.numeric(histologicTypeIcdO3), 8050, 8084) ~ 'Squamous Cell Carcinoma',
    between(as.numeric(histologicTypeIcdO3), 8012, 8014) ~ 'Large Cell Carcinoma',
    between(as.numeric(histologicTypeIcdO3), 8041, 8045) ~ 'Small Cell Carcinoma',
    TRUE ~ 'Other'
  ))